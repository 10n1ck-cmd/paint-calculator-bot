<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∫—Ä–∞—Å–∫–∏</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body{font-family:Arial;margin:0;padding:15px;background:#f7f7f7}
input,select,button{width:100%;padding:10px;margin:6px 0;font-size:16px}
button{background:#0088cc;color:#fff;border:none;border-radius:6px}
.card{background:#fff;padding:15px;border-radius:8px;margin-bottom:15px}
.banner{font-size:13px;color:#666;text-align:center;margin-top:20px}
.color{display:inline-block;width:30px;height:30px;border-radius:4px;margin:4px;border:1px solid #ccc}
</style>
</head>

<body>
<div class="card">
<h3>üìê –ü–ª–æ—â–∞–¥—å (–º¬≤)</h3>
<input id="area" type="number" step="0.01">
</div>

<div class="card">
<h3>üß± –¢–∏–ø –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏</h3>
<select id="surface">
<option>–ú–∞—Ç–æ–≤–∞—è</option>
<option>–ì–ª—è–Ω—Ü–µ–≤–∞—è</option>
<option>–ú—É–∞—Ä</option>
<option>–®–∞–≥—Ä–µ–Ω—å</option>
<option>–ê–Ω—Ç–∏–∫</option>
</select>
</div>

<div class="card">
<h3>üé® –¶–≤–µ—Ç</h3>
<div id="colors">
<div class="color" style="background:#000" onclick="setColor('RAL 9005')"></div>
<div class="color" style="background:#fff" onclick="setColor('RAL 9010')"></div>
<div class="color" style="background:#ff00ff" onclick="setColor('Neon')"></div>
</div>
<input id="color" readonly>
</div>

<div class="card">
<button onclick="calculate()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
<button onclick="savePDF()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ PDF</button>
<button onclick="order()">–ü–æ–ª—É—á–∏—Ç—å –≤—ã–≥–æ–¥–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</button>
</div>

<div class="banner">
–¢—É—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–∞—à–∞ —Ä–µ–∫–ª–∞–º–∞<br>
–û–±—Ä–∞—â–∞–π—Ç–µ—Å—å: <b>@A_n1ck</b>
</div>

<script>
const tg = Telegram.WebApp;
const user = tg.initDataUnsafe.user || {};

let lastResult = null;

function setColor(c){document.getElementById('color').value=c}

function calculate(){
    fetch('/api/calc',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({
            area:+area.value,
            mode:'theory',
            paints:[
                {name:'–ö—Ä–∞—Å–∫–∞ A',density:1.3,thickness:0.12,price:450},
                {name:'–ö—Ä–∞—Å–∫–∞ B',density:1.1,thickness:0.1,price:520}
            ]
        })
    }).then(r=>r.json()).then(d=>lastResult=d)
}

function savePDF(){
    fetch('/api/pdf',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(lastResult)})
    .then(r=>r.blob()).then(b=>{
        const a=document.createElement('a');
        a.href=URL.createObjectURL(b);
        a.download='comparison.pdf';
        a.click();
    })
}

function order(){
    fetch('/api/order',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({
            ...lastResult,
            area:+area.value,
            surface:surface.value,
            color:color.value,
            qty:10,
            tg:user
        })
    })
}
</script>
</body>
</html>
