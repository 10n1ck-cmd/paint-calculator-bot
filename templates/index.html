<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport"
 content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–æ—Ä–æ—à–∫–æ–≤–æ–π –∫—Ä–∞—Å–∫–∏</title>

<style>
body {
  font-family: system-ui, -apple-system;
  background:#f8fafc;
  margin:0;
}
.container {
  max-width:720px;
  margin:auto;
  padding:12px;
}
.tabs {
  display:flex;
  gap:6px;
  margin-bottom:12px;
}
.tab-btn {
  flex:1;
  padding:10px;
  border:none;
  border-radius:8px;
  background:#e5e7eb;
  font-size:14px;
}
.tab-btn.active {
  background:#2563eb;
  color:white;
}
.tab {
  display:none;
}
.tab.active {
  display:block;
}
input, select, button {
  width:100%;
  padding:10px;
  margin-top:8px;
  font-size:16px;
}
button {
  background:#2563eb;
  color:white;
  border:none;
  border-radius:8px;
}
.block {
  background:#e5e7eb;
  padding:12px;
  border-radius:8px;
  margin-top:12px;
}
.banner {
  margin-top:24px;
  padding:12px;
  background:#f1f5f9;
  text-align:center;
  font-size:14px;
}
h3 { margin-top:16px; }
</style>
</head>

<body>
<div class="container">

<!-- –í–ö–õ–ê–î–ö–ò -->
<div class="tabs">
  <button class="tab-btn active" onclick="openTab(0)">üéì –¢–µ–æ—Ä–∏—è</button>
  <button class="tab-btn" onclick="openTab(1)">üîß –ü—Ä–∞–∫—Ç–∏–∫–∞</button>
  <button class="tab-btn" onclick="openTab(2)">üìä –†–µ–∑—É–ª—å—Ç–∞—Ç</button>
  <button class="tab-btn" onclick="openTab(3)">üõí –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</button>
</div>

<!-- –¢–ï–û–†–ò–Ø -->
<div class="tab active">
  <h3>–ü–ª–æ—â–∞–¥—å</h3>
  <input id="area" type="number" step="0.001" placeholder="–º¬≤">
  <input id="loss" type="number" value="15" placeholder="–ü–æ—Ç–µ—Ä–∏ %">

  <h3>–ö—Ä–∞—Å–∫–∞ 1</h3>
  <input id="d1" placeholder="–ü–ª–æ—Ç–Ω–æ—Å—Ç—å –≥/—Å–º¬≥" type="number" step="0.001">
  <input id="t1" placeholder="–¢–æ–ª—â–∏–Ω–∞ –º–∫–º" type="number">
  <input id="p1" placeholder="–¶–µ–Ω–∞ ‚ÇΩ/–∫–≥" type="number" step="0.01">

  <h3>–ö—Ä–∞—Å–∫–∞ 2</h3>
  <input id="d2" placeholder="–ü–ª–æ—Ç–Ω–æ—Å—Ç—å –≥/—Å–º¬≥" type="number" step="0.001">
  <input id="t2" placeholder="–¢–æ–ª—â–∏–Ω–∞ –º–∫–º" type="number">
  <input id="p2" placeholder="–¶–µ–Ω–∞ ‚ÇΩ/–∫–≥" type="number" step="0.01">

  <button onclick="calc()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
</div>

<!-- –ü–†–ê–ö–¢–ò–ö–ê -->
<div class="tab">
  <h3>–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—Ö–æ–¥</h3>
  <input id="q1" placeholder="–ö—Ä–∞—Å–∫–∞ 1, –∫–≥" type="number" step="0.001">
  <input id="q2" placeholder="–ö—Ä–∞—Å–∫–∞ 2, –∫–≥" type="number" step="0.001">
</div>

<!-- –†–ï–ó–£–õ–¨–¢–ê–¢ -->
<div class="tab">
  <div id="result" class="block">–†–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ –¥–∞–Ω–Ω—ã–µ</div>
</div>

<!-- –ó–ê–ö–ê–ó -->
<div class="tab">
  <select id="surface">
    <option>–ú–∞—Ç–æ–≤–∞—è</option>
    <option>–ì–ª—è–Ω—Ü–µ–≤–∞—è</option>
    <option>–ú—É–∞—Ä</option>
    <option>–®–∞–≥—Ä–µ–Ω—å</option>
    <option>–ê–Ω—Ç–∏–∫</option>
  </select>

  <input id="color" placeholder="–¶–≤–µ—Ç (RAL)">
  <input id="quantity" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–≥" type="number" step="0.1">

  <button onclick="send()">–ü–æ–ª—É—á–∏—Ç—å –≤—ã–≥–æ–¥–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</button>

  <div class="banner">
    –¢—É—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–∞—à–∞ —Ä–µ–∫–ª–∞–º–∞<br>
    –û–±—Ä–∞—â–∞–π—Ç–µ—Å—å: <b>@A_n1ck</b>
  </div>
</div>

</div>

<script>
const tg = window.Telegram?.WebApp;
let data = {};

function openTab(i){
  document.querySelectorAll(".tab").forEach((t,n)=>t.classList.toggle("active",n===i));
  document.querySelectorAll(".tab-btn").forEach((b,n)=>b.classList.toggle("active",n===i));
}

function calc(){
  const S = +area.value;
  const loss = +loss.value/100;

  const d1v=+d1.value, t1v=+t1.value, p1v=+p1.value;
  const d2v=+d2.value, t2v=+t2.value, p2v=+p2.value;

  if([S,d1v,t1v,p1v,d2v,t2v,p2v].some(isNaN)){
    alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ç–µ–æ—Ä–∏—é");
    return;
  }

  const q1t = d1v*t1v/1000*S*(1+loss);
  const q2t = d2v*t2v/1000*S*(1+loss);

  const c1t = q1t*p1v;
  const c2t = q2t*p2v;

  data.theory={q1:q1t,q2:q2t,c1:c1t,c2:c2t};

  let html = `
<b>–¢–µ–æ—Ä–∏—è</b><br>
–ö—Ä–∞—Å–∫–∞ 1: ${q1t.toFixed(3)} –∫–≥ / ${c1t.toFixed(2)} ‚ÇΩ<br>
–ö—Ä–∞—Å–∫–∞ 2: ${q2t.toFixed(3)} –∫–≥ / ${c2t.toFixed(2)} ‚ÇΩ<br>
`;

  const q1p=+q1.value, q2p=+q2.value;
  if(!isNaN(q1p)&&!isNaN(q2p)){
    const c1p=q1p*p1v, c2p=q2p*p2v;
    data.practice={q1:q1p,q2:q2p,c1:c1p,c2:c2p};
    html+=`<br><b>–ü—Ä–∞–∫—Ç–∏–∫–∞</b><br>
–ö—Ä–∞—Å–∫–∞ 1: ${c1p.toFixed(2)} ‚ÇΩ<br>
–ö—Ä–∞—Å–∫–∞ 2: ${c2p.toFixed(2)} ‚ÇΩ<br>`;
  }

  const base=data.practice??data.theory;
  const cheaper=base.c1<base.c2?"–ö—Ä–∞—Å–∫–∞ 1":"–ö—Ä–∞—Å–∫–∞ 2";
  const percent=(Math.abs(base.c1-base.c2)/Math.max(base.c1,base.c2)*100).toFixed(1);

  data.summary={cheaper,percent};

  html+=`<br><b>–í—ã–≥–æ–¥–Ω–µ–µ:</b> ${cheaper}<br><b>–≠–∫–æ–Ω–æ–º–∏—è:</b> ${percent}%`;

  result.innerHTML=html;
  openTab(2);
}

function send(){
  fetch("/api/order",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      telegram:tg?.initDataUnsafe?.user,
      calc:data,
      order:{
        surface:surface.value,
        color:color.value,
        quantity:quantity.value
      }
    })
  }).then(()=>alert("–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –∞–¥–º–∏–Ω—É"));
}
</script>

</body>
</html>
