<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–æ—Ä–æ—à–∫–æ–≤–æ–π –∫—Ä–∞—Å–∫–∏</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body {
    font-family: system-ui, sans-serif;
    background: #f4f6f8;
    margin: 0;
}
.container {
    max-width: 420px;
    margin: auto;
    padding: 16px;
}
button {
    width: 100%;
    padding: 12px;
    margin-top: 8px;
    border: none;
    border-radius: 8px;
    background: #2a9df4;
    color: #fff;
    font-size: 16px;
}
input {
    width: 100%;
    padding: 10px;
    margin-top: 6px;
    font-size: 16px;
}
.card {
    background: #fff;
    padding: 12px;
    margin-top: 12px;
    border-radius: 10px;
}
.hidden { display: none; }
.result {
    background: #e9f5ff;
    padding: 10px;
    border-radius: 8px;
    margin-top: 12px;
}
.error {
    background: #ffdede;
    padding: 10px;
    border-radius: 8px;
    margin-top: 12px;
}
</style>
</head>

<body>
<div class="container">
<h2>üé® –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</h2>

<button onclick="showTheory()">üéì –¢–µ–æ—Ä–∏—è</button>
<button onclick="showPractice()">üîß –ü—Ä–∞–∫—Ç–∏–∫–∞</button>

<div id="theory" class="card hidden">
    <input id="t_area" placeholder="–ü–ª–æ—â–∞–¥—å –º¬≤">
    <input id="t_density" placeholder="–ü–ª–æ—Ç–Ω–æ—Å—Ç—å –≥/—Å–º¬≥">
    <input id="t_thickness" placeholder="–¢–æ–ª—â–∏–Ω–∞ –º–∫–º">
    <input id="t_price" placeholder="–¶–µ–Ω–∞ ‚ÇΩ/–∫–≥">
    <button onclick="calcTheory()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
</div>

<div id="practice" class="card hidden">
    <input id="p_area" placeholder="–ü–ª–æ—â–∞–¥—å –º¬≤">
    <input id="p_cons" placeholder="–†–∞—Å—Ö–æ–¥ –∫–≥">
    <input id="p_price" placeholder="–¶–µ–Ω–∞ ‚ÇΩ/–∫–≥">
    <button onclick="calcPractice()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
</div>

<div id="msg" class="result hidden"></div>
</div>

<script>
Telegram.WebApp.expand();

function showTheory(){
    theory.classList.remove('hidden');
    practice.classList.add('hidden');
    msg.classList.add('hidden');
}

function showPractice(){
    practice.classList.remove('hidden');
    theory.classList.add('hidden');
    msg.classList.add('hidden');
}

function num(id){
    const v = document.getElementById(id).value.replace(',', '.');
    if(!v) throw "–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è";
    return parseFloat(v);
}

async function send(data){
    const r = await fetch('/api/calculate',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify(data)
    });
    const j = await r.json();
    if(!r.ok) throw j.error;
    return j;
}

async function calcTheory(){
    try{
        const r = await send({
            mode:'theoretical',
            area:num('t_area'),
            paint1:{
                density:num('t_density'),
                thickness:num('t_thickness'),
                price:num('t_price')
            }
        });
        show(r.paint1);
    }catch(e){ showError(e); }
}

async function calcPractice(){
    try{
        const r = await send({
            mode:'practical',
            area:num('p_area'),
            paint1:{
                consumption:num('p_cons'),
                price:num('p_price')
            }
        });
        show(r.paint1);
    }catch(e){ showError(e); }
}

function show(p){
    msg.className = "result";
    msg.innerHTML =
        `–†–∞—Å—Ö–æ–¥: <b>${p.consumption} –∫–≥</b><br>
         –ü–æ–∫—Ä—ã—Ç–∏–µ: <b>${p.coverage} –º¬≤/–∫–≥</b><br>
         –°—Ç–æ–∏–º–æ—Å—Ç—å: <b>${p.cost} ‚ÇΩ</b><br>
         –¶–µ–Ω–∞ –º¬≤: <b>${p.cost_per_sqm} ‚ÇΩ</b>`;
    msg.classList.remove('hidden');
}

function showError(e){
    msg.className = "error";
    msg.innerText = "–û—à–∏–±–∫–∞: " + e;
    msg.classList.remove('hidden');
}
</script>
</body>
</html>
