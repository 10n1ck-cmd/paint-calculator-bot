<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–æ—Ä–æ—à–∫–æ–≤–æ–π –∫—Ä–∞—Å–∫–∏</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial;background:#f4f6f8;padding:15px}
.container{max-width:900px;margin:auto;background:#fff;padding:20px;border-radius:10px}
.block{border:1px solid #ccc;padding:15px;margin-top:15px;border-radius:8px}
.hidden{display:none}
table{width:100%;border-collapse:collapse;margin-top:20px}
th,td{border:1px solid #ccc;padding:8px;text-align:center}
.good{background:#e6ffe6}
</style>
</head>

<body>
<div class="container">
<h1>üé® –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–æ—Ä–æ—à–∫–æ–≤–æ–π –∫—Ä–∞—Å–∫–∏</h1>

<select id="mode" onchange="toggle()">
<option value="theoretical">–¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–π</option>
<option value="practical">–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π</option>
</select>

<input id="area" placeholder="–ü–ª–æ—â–∞–¥—å –º¬≤">

<div id="theory" class="block">
<h3>–¢–µ–æ—Ä–∏—è</h3>
<input id="t1_name" placeholder="–ö—Ä–∞—Å–∫–∞ 1">
<input id="t1_density" placeholder="–ü–ª–æ—Ç–Ω–æ—Å—Ç—å">
<input id="t1_thickness" placeholder="–¢–æ–ª—â–∏–Ω–∞">
<input id="t1_price" placeholder="–¶–µ–Ω–∞">

<input id="t2_name" placeholder="–ö—Ä–∞—Å–∫–∞ 2">
<input id="t2_density" placeholder="–ü–ª–æ—Ç–Ω–æ—Å—Ç—å">
<input id="t2_thickness" placeholder="–¢–æ–ª—â–∏–Ω–∞">
<input id="t2_price" placeholder="–¶–µ–Ω–∞">
</div>

<div id="practice" class="block hidden">
<h3>–ü—Ä–∞–∫—Ç–∏–∫–∞</h3>
<input id="p1_name" placeholder="–ö—Ä–∞—Å–∫–∞ 1">
<input id="p1_cons" placeholder="–†–∞—Å—Ö–æ–¥">
<input id="p1_price" placeholder="–¶–µ–Ω–∞">

<input id="p2_name" placeholder="–ö—Ä–∞—Å–∫–∞ 2">
<input id="p2_cons" placeholder="–†–∞—Å—Ö–æ–¥">
<input id="p2_price" placeholder="–¶–µ–Ω–∞">
</div>

<button onclick="calc()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
<button onclick="pdf()">üìÑ PDF</button>

<table id="result" class="hidden"></table>
</div>

<script>
let last=null
const num=v=>parseFloat(String(v).replace(',','.'))||0

function toggle(){
theory.classList.toggle('hidden',mode.value!=='theoretical')
practice.classList.toggle('hidden',mode.value!=='practical')
}

async function calc(){
let data={
mode:mode.value,
area:num(area.value)
}

if(mode.value==='theoretical'){
data.paint1={name:t1_name.value,density:num(t1_density.value),thickness:num(t1_thickness.value),price:num(t1_price.value)}
data.paint2={name:t2_name.value,density:num(t2_density.value),thickness:num(t2_thickness.value),price:num(t2_price.value)}
}else{
data.paint1={name:p1_name.value,consumption:num(p1_cons.value),price:num(p1_price.value)}
data.paint2={name:p2_name.value,consumption:num(p2_cons.value),price:num(p2_price.value)}
}

let r=await fetch('/api/calculate',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)})
last=await r.json()
render(last)
}

function render(r){
result.classList.remove('hidden')
result.innerHTML=`
<tr><th>–ö—Ä–∞—Å–∫–∞</th><th>–†–∞—Å—Ö–æ–¥</th><th>–ü–æ–∫—Ä—ã—Ç–∏–µ</th><th>–°—Ç–æ–∏–º–æ—Å—Ç—å</th><th>–¶–µ–Ω–∞ –º¬≤</th></tr>
<tr class="good"><td>${r.paint1.name}</td><td>${r.paint1.consumption}</td><td>${r.paint1.coverage}</td><td>${r.paint1.cost}</td><td>${r.paint1.cost_per_sqm}</td></tr>
<tr><td>${r.paint2.name}</td><td>${r.paint2.consumption}</td><td>${r.paint2.coverage}</td><td>${r.paint2.cost}</td><td>${r.paint2.cost_per_sqm}</td></tr>
`
}

async function pdf(){
if(!last){alert('–°–Ω–∞—á–∞–ª–∞ —Ä–∞—Å—á–µ—Ç');return}
const r=await fetch('/api/pdf',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(last)})
const b=await r.blob()
const a=document.createElement('a')
a.href=URL.createObjectURL(b)
a.download='calculation.pdf'
a.click()
}
</script>
</body>
</html>
