<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–æ—Ä–æ—à–∫–æ–≤—ã—Ö –∫—Ä–∞—Å–æ–∫</title>

<style>
body { font-family: Arial, sans-serif; margin: 0; padding: 14px; background:#fafafa; }
button { width:100%; padding:14px; margin:8px 0; font-size:16px; }
input, select { width:100%; padding:8px; margin:4px 0; font-size:15px; }
.card { background:#fff; padding:12px; margin-bottom:12px; border-radius:6px; }
.hidden { display:none; }
.result { background:#eef3ff; padding:10px; border-radius:6px; }
.banner { margin-top:20px; font-size:14px; text-align:center; color:#555; }
</style>
</head>

<body>

<!-- –ì–õ–ê–í–ù–´–ô –≠–ö–†–ê–ù -->
<div id="home">
  <button onclick="openCalc('theory')">üìê –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç</button>
  <button onclick="openCalc('practice')">üß™ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç</button>
</div>

<!-- –≠–ö–†–ê–ù –†–ê–°–ß–Å–¢–ê -->
<div id="calc" class="hidden">
  <button onclick="back()">‚Üê –ù–∞–∑–∞–¥</button>
  <h3 id="title"></h3>

  <div class="card">
    <h4>–ö—Ä–∞—Å–∫–∞ 1</h4>
    <input id="a1" placeholder="–ü–ª–æ—â–∞–¥—å / –†–∞—Å—Ö–æ–¥ (–∫–≥)">
    <input id="b1" placeholder="–ü–ª–æ—Ç–Ω–æ—Å—Ç—å / –ü–ª–æ—â–∞–¥—å (–º¬≤)">
    <input id="c1" placeholder="–¢–æ–ª—â–∏–Ω–∞ (–º–∫–º) / –¶–µ–Ω–∞ (‚ÇΩ/–∫–≥)">
    <input id="d1" placeholder="–¶–µ–Ω–∞ (‚ÇΩ/–∫–≥)">
    <input id="loss1" placeholder="–ü–æ—Ç–µ—Ä–∏ (%) ‚Äî —Ç–æ–ª—å–∫–æ —Ç–µ–æ—Ä–∏—è">
  </div>

  <div class="card">
    <h4>–ö—Ä–∞—Å–∫–∞ 2</h4>
    <input id="a2">
    <input id="b2">
    <input id="c2">
    <input id="d2">
    <input id="loss2">
  </div>

  <button onclick="calculate()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>

  <div id="result" class="result hidden"></div>

  <button id="orderBtn" class="hidden" onclick="sendOrder()">
    –ü–æ–ª—É—á–∏—Ç—å –≤—ã–≥–æ–¥–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
  </button>
</div>

<div class="banner">
  –¢—É—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–∞—à–∞ —Ä–µ–∫–ª–∞–º–∞<br>
  <a href="https://t.me/A_n1ck" target="_blank">@A_n1ck</a>
</div>

<script>
let mode = null;
let calcData = null;
const tg = window.Telegram?.WebApp;

function v(id){
  return parseFloat(document.getElementById(id).value.replace(",", "."));
}

function openCalc(m){
  mode = m;
  document.getElementById("home").classList.add("hidden");
  document.getElementById("calc").classList.remove("hidden");
  document.getElementById("title").innerText =
    m === "theory" ? "–¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç" : "–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç";
}

function back(){
  document.getElementById("calc").classList.add("hidden");
  document.getElementById("home").classList.remove("hidden");
}

function calculate(){
  let r1, r2, kgm1, kgm2;

  if(mode === "theory"){
    kgm1 = (v("b1") * v("c1") * (1 + v("loss1")/100)) / 1000;
    kgm2 = (v("b2") * v("c2") * (1 + v("loss2")/100)) / 1000;
  } else {
    kgm1 = v("a1") / v("b1");
    kgm2 = v("a2") / v("b2");
  }

  r1 = kgm1 * v("d1");
  r2 = kgm2 * v("d2");

  const cheaper = r1 < r2 ? "–ö—Ä–∞—Å–∫–∞ 1" : "–ö—Ä–∞—Å–∫–∞ 2";
  const economyRub = Math.abs(r1 - r2);
  const economyPct = Math.round((economyRub / Math.max(r1, r2)) * 1000) / 10;

  calcData = { kgm1, kgm2, r1, r2, cheaper, economyRub, economyPct, mode };

  document.getElementById("result").innerHTML = `
    <b>–†–µ–∑—É–ª—å—Ç–∞—Ç:</b><br>
    –ö—Ä–∞—Å–∫–∞ 1: ${kgm1.toFixed(3)} –∫–≥/–º¬≤ ¬∑ ${r1.toFixed(2)} ‚ÇΩ/–º¬≤<br>
    –ö—Ä–∞—Å–∫–∞ 2: ${kgm2.toFixed(3)} –∫–≥/–º¬≤ ¬∑ ${r2.toFixed(2)} ‚ÇΩ/–º¬≤<br><br>
    <b>–í—ã–≥–æ–¥–Ω–µ–µ:</b> ${cheaper}<br>
    –≠–∫–æ–Ω–æ–º–∏—è: ${economyRub.toFixed(2)} ‚ÇΩ/–º¬≤ (${economyPct}%)
  `;

  document.getElementById("result").classList.remove("hidden");
  document.getElementById("orderBtn").classList.remove("hidden");
}

function sendOrder(){
  fetch("/api/order",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({
      calc: calcData,
      user: tg?.initDataUnsafe?.user || null
    })
  });
  alert("–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É");
}
</script>

</body>
</html>
