<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport"
 content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–æ—Ä–æ—à–∫–æ–≤–æ–π –∫—Ä–∞—Å–∫–∏</title>

<style>
body { font-family: system-ui; background:#f8fafc; margin:0; }
.container { max-width:700px; margin:auto; padding:16px; }
h2,h3 { margin-top:24px; }
input,select,button {
  width:100%; padding:10px; margin-top:8px; font-size:16px;
}
button { background:#2563eb; color:#fff; border:none; border-radius:6px; }
.block { background:#e5e7eb; padding:12px; border-radius:6px; margin-top:12px; }
.banner {
  margin-top:24px; padding:12px; background:#f1f5f9; text-align:center;
  font-size:14px;
}
</style>
</head>

<body>
<div class="container">

<h2>üéì –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç</h2>

<label>–ü–ª–æ—â–∞–¥—å, –º¬≤</label>
<input id="area" type="number" step="0.001">

<label>–ü–æ—Ç–µ—Ä–∏, %</label>
<input id="loss" type="number" value="15">

<h3>–ö—Ä–∞—Å–∫–∞ 1</h3>
<input id="d1" placeholder="–ü–ª–æ—Ç–Ω–æ—Å—Ç—å, –≥/—Å–º¬≥" type="number" step="0.001">
<input id="t1" placeholder="–¢–æ–ª—â–∏–Ω–∞, –º–∫–º" type="number">
<input id="p1" placeholder="–¶–µ–Ω–∞, ‚ÇΩ/–∫–≥" type="number" step="0.01">

<h3>–ö—Ä–∞—Å–∫–∞ 2</h3>
<input id="d2" placeholder="–ü–ª–æ—Ç–Ω–æ—Å—Ç—å, –≥/—Å–º¬≥" type="number" step="0.001">
<input id="t2" placeholder="–¢–æ–ª—â–∏–Ω–∞, –º–∫–º" type="number">
<input id="p2" placeholder="–¶–µ–Ω–∞, ‚ÇΩ/–∫–≥" type="number" step="0.01">

<button onclick="calc()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>

<div id="theory" class="block"></div>

<h2>üîß –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—Ö–æ–¥</h2>

<input id="q1" placeholder="–§–∞–∫—Ç. —Ä–∞—Å—Ö–æ–¥ –∫—Ä–∞—Å–∫–∏ 1, –∫–≥" type="number" step="0.001">
<input id="q2" placeholder="–§–∞–∫—Ç. —Ä–∞—Å—Ö–æ–¥ –∫—Ä–∞—Å–∫–∏ 2, –∫–≥" type="number" step="0.001">

<div id="practice" class="block"></div>

<h2>üõí –ü–æ–ª—É—á–∏—Ç—å –≤—ã–≥–æ–¥–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</h2>

<select id="surface">
  <option>–ú–∞—Ç–æ–≤–∞—è</option>
  <option>–ì–ª—è–Ω—Ü–µ–≤–∞—è</option>
  <option>–ú—É–∞—Ä</option>
  <option>–®–∞–≥—Ä–µ–Ω—å</option>
  <option>–ê–Ω—Ç–∏–∫</option>
</select>

<input id="color" placeholder="–¶–≤–µ—Ç">
<input id="quantity" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ, –∫–≥" type="number" step="0.1">

<button onclick="send()">–ü–æ–ª—É—á–∏—Ç—å –≤—ã–≥–æ–¥–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</button>

<div class="banner">
–¢—É—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–∞—à–∞ —Ä–µ–∫–ª–∞–º–∞<br>
–û–±—Ä–∞—â–∞–π—Ç–µ—Å—å: <b>@A_n1ck</b>
</div>

</div>

<script>
const tg = window.Telegram.WebApp;
let result = {};

function calc() {
  const S = +area.value;
  const loss = +loss.value / 100;

  const d1v = +d1.value, t1v = +t1.value, p1v = +p1.value;
  const d2v = +d2.value, t2v = +t2.value, p2v = +p2.value;

  if ([S,d1v,t1v,p1v,d2v,t2v,p2v].some(isNaN)) {
    alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è —Ç–µ–æ—Ä–∏–∏");
    return;
  }

  // q = rho * h / 1000
  const q1t = d1v * t1v / 1000 * S * (1 + loss);
  const q2t = d2v * t2v / 1000 * S * (1 + loss);

  const c1t = q1t * p1v;
  const c2t = q2t * p2v;

  theory.innerHTML = `
<b>–¢–µ–æ—Ä–∏—è:</b><br>
–ö—Ä–∞—Å–∫–∞ 1: ${q1t.toFixed(3)} –∫–≥ / ${c1t.toFixed(2)} ‚ÇΩ<br>
–ö—Ä–∞—Å–∫–∞ 2: ${q2t.toFixed(3)} –∫–≥ / ${c2t.toFixed(2)} ‚ÇΩ
`;

  result.theory = { q1:q1t, q2:q2t, c1:c1t, c2:c2t };

  const q1p = +q1.value, q2p = +q2.value;
  if (!isNaN(q1p) && !isNaN(q2p)) {
    const c1p = q1p * p1v;
    const c2p = q2p * p2v;

    practice.innerHTML = `
<b>–ü—Ä–∞–∫—Ç–∏–∫–∞:</b><br>
–ö—Ä–∞—Å–∫–∞ 1: ${c1p.toFixed(2)} ‚ÇΩ<br>
–ö—Ä–∞—Å–∫–∞ 2: ${c2p.toFixed(2)} ‚ÇΩ
`;

    result.practice = { q1:q1p, q2:q2p, c1:c1p, c2:c2p };
  }

  const base = result.practice ?? result.theory;
  const cheaper = base.c1 < base.c2 ? "–ö—Ä–∞—Å–∫–∞ 1" : "–ö—Ä–∞—Å–∫–∞ 2";
  const percent = (Math.abs(base.c1-base.c2)/Math.max(base.c1,base.c2)*100).toFixed(1);

  practice.innerHTML += `<br><b>–í—ã–≥–æ–¥–Ω–µ–µ:</b> ${cheaper}<br><b>–≠–∫–æ–Ω–æ–º–∏—è:</b> ${percent}%`;

  result.summary = { cheaper, percent };
}

function send() {
  fetch("/api/order",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({
      telegram: tg.initDataUnsafe.user,
      result,
      order:{
        surface:surface.value,
        color:color.value,
        quantity:quantity.value
      }
    })
  }).then(()=>alert("–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∞–¥–º–∏–Ω—É"));
}
</script>

</body>
</html>
