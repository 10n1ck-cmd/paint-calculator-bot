<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport"
 content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–æ—Ä–æ—à–∫–æ–≤–æ–π –∫—Ä–∞—Å–∫–∏</title>

<style>
body { font-family: system-ui; background:#f8fafc; margin:0; }
.container { max-width:720px; margin:auto; padding:12px; }
.tabs { display:flex; gap:6px; margin-bottom:12px; }
.tab-btn {
  flex:1; padding:10px; border:none; border-radius:8px;
  background:#e5e7eb; font-size:14px;
}
.tab-btn.active { background:#2563eb; color:white; }
.tab { display:none; }
.tab.active { display:block; }

input, select, button {
  width:100%; padding:10px; margin-top:8px; font-size:16px;
}
button {
  background:#2563eb; color:white; border:none; border-radius:8px;
}
.block {
  background:#e5e7eb; padding:12px; border-radius:8px; margin-top:12px;
}
.banner {
  margin-top:24px; padding:12px; background:#f1f5f9;
  text-align:center; font-size:14px;
}
h3 { margin-top:16px; }
</style>
</head>

<body>
<div class="container">

<!-- –í–ö–õ–ê–î–ö–ò -->
<div class="tabs">
  <button class="tab-btn active" onclick="openTab(0)">üéì –¢–µ–æ—Ä–∏—è</button>
  <button class="tab-btn" onclick="openTab(1)">üîß –ü—Ä–∞–∫—Ç–∏–∫–∞</button>
  <button class="tab-btn" onclick="openTab(2)">üìä –†–µ–∑—É–ª—å—Ç–∞—Ç</button>
  <button class="tab-btn" onclick="openTab(3)">üõí –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</button>
</div>

<!-- –¢–ï–û–†–ò–Ø -->
<div class="tab active">
  <input id="area" placeholder="–ü–ª–æ—â–∞–¥—å, –º¬≤" type="number" step="0.001">
  <input id="loss" placeholder="–ü–æ—Ç–µ—Ä–∏ %" type="number">

  <h3>–ö—Ä–∞—Å–∫–∞ 1</h3>
  <input id="d1" placeholder="–ü–ª–æ—Ç–Ω–æ—Å—Ç—å –≥/—Å–º¬≥" type="number" step="0.001">
  <input id="t1" placeholder="–¢–æ–ª—â–∏–Ω–∞ –º–∫–º" type="number">
  <input id="tp1" placeholder="–¶–µ–Ω–∞ ‚ÇΩ/–∫–≥" type="number" step="0.01">

  <h3>–ö—Ä–∞—Å–∫–∞ 2</h3>
  <input id="d2" placeholder="–ü–ª–æ—Ç–Ω–æ—Å—Ç—å –≥/—Å–º¬≥" type="number" step="0.001">
  <input id="t2" placeholder="–¢–æ–ª—â–∏–Ω–∞ –º–∫–º" type="number">
  <input id="tp2" placeholder="–¶–µ–Ω–∞ ‚ÇΩ/–∫–≥" type="number" step="0.01">

  <button onclick="calcTheory()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ç–µ–æ—Ä–∏—é</button>
</div>

<!-- –ü–†–ê–ö–¢–ò–ö–ê -->
<div class="tab">
  <h3>–ö—Ä–∞—Å–∫–∞ 1</h3>
  <input id="q1" placeholder="–§–∞–∫—Ç. —Ä–∞—Å—Ö–æ–¥, –∫–≥" type="number" step="0.001">
  <input id="pp1" placeholder="–¶–µ–Ω–∞ ‚ÇΩ/–∫–≥" type="number" step="0.01">

  <h3>–ö—Ä–∞—Å–∫–∞ 2</h3>
  <input id="q2" placeholder="–§–∞–∫—Ç. —Ä–∞—Å—Ö–æ–¥, –∫–≥" type="number" step="0.001">
  <input id="pp2" placeholder="–¶–µ–Ω–∞ ‚ÇΩ/–∫–≥" type="number" step="0.01">

  <button onclick="calcPractice()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø—Ä–∞–∫—Ç–∏–∫—É</button>
</div>

<!-- –†–ï–ó–£–õ–¨–¢–ê–¢ -->
<div class="tab">
  <div id="result" class="block">–ù–µ—Ç —Ä–∞—Å—á—ë—Ç–æ–≤</div>
</div>

<!-- –ó–ê–ö–ê–ó -->
<div class="tab">
  <select id="surface">
    <option>–ú–∞—Ç–æ–≤–∞—è</option>
    <option>–ì–ª—è–Ω—Ü–µ–≤–∞—è</option>
    <option>–ú—É–∞—Ä</option>
    <option>–®–∞–≥—Ä–µ–Ω—å</option>
    <option>–ê–Ω—Ç–∏–∫</option>
  </select>
  <input id="color" placeholder="–¶–≤–µ—Ç (RAL)">
  <input id="quantity" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ, –∫–≥" type="number" step="0.1">
  <button onclick="send()">–ü–æ–ª—É—á–∏—Ç—å –≤—ã–≥–æ–¥–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</button>

  <div class="banner">
    –¢—É—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–∞—à–∞ —Ä–µ–∫–ª–∞–º–∞<br>
    –û–±—Ä–∞—â–∞–π—Ç–µ—Å—å: <b>@A_n1ck</b>
  </div>
</div>

</div>

<script>
const tg = window.Telegram?.WebApp;
let data = {};

function openTab(i){
  document.querySelectorAll(".tab").forEach((t,n)=>t.classList.toggle("active",n===i));
  document.querySelectorAll(".tab-btn").forEach((b,n)=>b.classList.toggle("active",n===i));
}

function calcTheory(){
  const S=+area.value, loss=+loss.value/100;
  const d1v=+d1.value, t1v=+t1.value, p1v=+tp1.value;
  const d2v=+d2.value, t2v=+t2.value, p2v=+tp2.value;

  if([S,d1v,t1v,p1v,d2v,t2v,p2v].some(isNaN)){ alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ç–µ–æ—Ä–∏—é"); return; }

  const q1=d1v*t1v/1000*S*(1+loss);
  const q2=d2v*t2v/1000*S*(1+loss);
  const c1=q1*p1v, c2=q2*p2v;

  data.theory={q1,q2,c1,c2};
  show();
  openTab(2);
}

function calcPractice(){
  const q1v=+q1.value, p1v=+pp1.value;
  const q2v=+q2.value, p2v=+pp2.value;

  if([q1v,p1v,q2v,p2v].some(isNaN)){ alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø—Ä–∞–∫—Ç–∏–∫—É"); return; }

  const c1=q1v*p1v, c2=q2v*p2v;
  data.practice={q1:q1v,q2:q2v,c1,c2};
  show();
  openTab(2);
}

function show(){
  const base=data.practice??data.theory;
  if(!base){ result.innerHTML="–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö"; return; }

  const cheaper=base.c1<base.c2?"–ö—Ä–∞—Å–∫–∞ 1":"–ö—Ä–∞—Å–∫–∞ 2";
  const percent=(Math.abs(base.c1-base.c2)/Math.max(base.c1,base.c2)*100).toFixed(1);

  data.summary={cheaper,percent};

  result.innerHTML=`
<b>–¢–µ–æ—Ä–∏—è:</b> ${data.theory?`${data.theory.c1.toFixed(2)} / ${data.theory.c2.toFixed(2)} ‚ÇΩ`:"‚Äî"}<br>
<b>–ü—Ä–∞–∫—Ç–∏–∫–∞:</b> ${data.practice?`${data.practice.c1.toFixed(2)} / ${data.practice.c2.toFixed(2)} ‚ÇΩ`:"‚Äî"}<br><br>
<b>–í—ã–≥–æ–¥–Ω–µ–µ:</b> ${cheaper}<br>
<b>–≠–∫–æ–Ω–æ–º–∏—è:</b> ${percent}%
`;
}

function send(){
  fetch("/api/order",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      telegram:tg?.initDataUnsafe?.user,
      calc:data,
      order:{
        surface:surface.value,
        color:color.value,
        quantity:quantity.value
      }
    })
  }).then(()=>alert("–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –∞–¥–º–∏–Ω—É"));
}
</script>

</body>
</html>
