<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–æ—Ä–æ—à–∫–æ–≤–æ–π –∫—Ä–∞—Å–∫–∏</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:Arial;background:#f4f6f8;padding:15px}
.container{max-width:900px;margin:auto;background:#fff;padding:20px;border-radius:10px}
label{font-weight:bold;margin-top:10px;display:block}
input,select,button{width:100%;padding:10px;margin-top:5px;border-radius:6px;border:1px solid #ccc}
button{background:#2d7ef7;color:#fff;font-size:16px;margin-top:15px}
.block{border:1px solid #ddd;padding:15px;border-radius:8px;margin-top:15px}
.hidden{display:none}
table{width:100%;border-collapse:collapse;margin-top:20px}
th,td{border:1px solid #ccc;padding:8px;text-align:center}
.good{background:#e6ffe6;font-weight:bold}
.bad{background:#ffecec}
.actions{display:flex;gap:10px;margin-top:15px}
.actions button{flex:1}
</style>
</head>

<body>
<div class="container">
<h1>üé® –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–æ—Ä–æ—à–∫–æ–≤–æ–π –∫—Ä–∞—Å–∫–∏</h1>

<label>–¢–∏–ø —Ä–∞—Å—á—ë—Ç–∞</label>
<select id="calcType" onchange="toggleCalc()">
<option value="theoretical">–¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–π</option>
<option value="practical">–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π</option>
</select>

<label>–ü–ª–æ—â–∞–¥—å –∏–∑–¥–µ–ª–∏—è (–º¬≤)</label>
<input id="product_area" inputmode="decimal" placeholder="2,5">

<!-- –¢–ï–û–†–ï–¢–ò–ß–ï–°–ö–ò–ô -->
<div id="theoretical">
<div class="block">
<h3>–ö—Ä–∞—Å–∫–∞ ‚Ññ1</h3>
<input id="p1_name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
<input id="p1_density" placeholder="–ü–ª–æ—Ç–Ω–æ—Å—Ç—å –≥/—Å–º¬≥">
<input id="p1_thickness" placeholder="–¢–æ–ª—â–∏–Ω–∞ –º–∫–º">
<input id="p1_price" placeholder="–¶–µ–Ω–∞ —Ä—É–±/–∫–≥">
</div>

<div class="block">
<h3>–ö—Ä–∞—Å–∫–∞ ‚Ññ2</h3>
<input id="p2_name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
<input id="p2_density" placeholder="–ü–ª–æ—Ç–Ω–æ—Å—Ç—å –≥/—Å–º¬≥">
<input id="p2_thickness" placeholder="–¢–æ–ª—â–∏–Ω–∞ –º–∫–º">
<input id="p2_price" placeholder="–¶–µ–Ω–∞ —Ä—É–±/–∫–≥">
</div>
</div>

<!-- –ü–†–ê–ö–¢–ò–ß–ï–°–ö–ò–ô -->
<div id="practical" class="hidden">
<div class="block">
<h3>–ö—Ä–∞—Å–∫–∞ ‚Ññ1</h3>
<input id="p1p_name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
<input id="p1_real" placeholder="–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—Ö–æ–¥ –∫–≥">
<input id="p1p_price" placeholder="–¶–µ–Ω–∞ —Ä—É–±/–∫–≥">
</div>

<div class="block">
<h3>–ö—Ä–∞—Å–∫–∞ ‚Ññ2</h3>
<input id="p2p_name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
<input id="p2_real" placeholder="–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—Ö–æ–¥ –∫–≥">
<input id="p2p_price" placeholder="–¶–µ–Ω–∞ —Ä—É–±/–∫–≥">
</div>
</div>

<button onclick="calculate()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>

<div id="out" class="hidden">
<table>
<thead id="tableHead"></thead>
<tbody id="tableBody"></tbody>
</table>

<div class="actions">
<button onclick="downloadPDF()">üìÑ PDF</button>
<button onclick="downloadExcel()">üìä Excel</button>
</div>
</div>

</div>

<script>
function num(v){
    return parseFloat(String(v).replace(',', '.')) || 0
}

function toggleCalc(){
    theoretical.classList.toggle('hidden', calcType.value !== 'theoretical')
    practical.classList.toggle('hidden', calcType.value !== 'practical')
}

async function calculate(){
let payload = {
    calc_type: calcType.value,
    product_area: num(product_area.value)
}
if(payload.product_area <= 0){
    alert('–í–≤–µ–¥–∏—Ç–µ –ø–ª–æ—â–∞–¥—å')
    return
}

if(calcType.value === 'theoretical'){
    payload.paint1 = {
        name: p1_name.value,
        density: num(p1_density.value),
        thickness: num(p1_thickness.value),
        price: num(p1_price.value)
    }
    payload.paint2 = {
        name: p2_name.value,
        density: num(p2_density.value),
        thickness: num(p2_thickness.value),
        price: num(p2_price.value)
    }
} else {
    payload.paint1 = {
        name: p1p_name.value,
        real_consumption: num(p1_real.value),
        price: num(p1p_price.value)
    }
    payload.paint2 = {
        name: p2p_name.value,
        real_consumption: num(p2_real.value),
        price: num(p2p_price.value)
    }
}

const r = await fetch('/api/calculate', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify(payload)
})
const j = await r.json()
if(!j.success){
    alert(j.error)
    return
}

render(j.result)
}

function render(r){
out.classList.remove('hidden')
tableBody.innerHTML = ''

const isTheory = r.comparison.calculation_type === 'theoretical'
const cheaper = r.comparison.cheaper_paint

tableHead.innerHTML = `
<tr>
<th>–ö—Ä–∞—Å–∫–∞</th>
<th>${isTheory ? '–†–∞—Å—Ö–æ–¥ (—Ä–∞—Å—á—ë—Ç)' : '–§–∞–∫—Ç. —Ä–∞—Å—Ö–æ–¥'} –∫–≥</th>
<th>–ü–æ–∫—Ä—ã—Ç–∏–µ –º¬≤/–∫–≥</th>
<th>–°—Ç–æ–∏–º–æ—Å—Ç—å ‚ÇΩ</th>
<th>–¶–µ–Ω–∞ –º¬≤ ‚ÇΩ</th>
</tr>
`

;['paint1','paint2'].forEach(k=>{
    const p = r[k]
    const tr = document.createElement('tr')
    tr.className = k === cheaper ? 'good' : 'bad'

    tr.innerHTML = `
    <td>${p.name}</td>
    <td>${(isTheory ? p.practical_consumption : p.real_consumption).toFixed(3)}</td>
    <td>${p.coverage_area.toFixed(2)}</td>
    <td>${p.product_cost.toFixed(2)}</td>
    <td>${p.cost_per_sqm.toFixed(2)}</td>
    `
    tableBody.appendChild(tr)
})
}

function downloadPDF(){
    alert('PDF ‚Äî —Å–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø')
}

function downloadExcel(){
    alert('Excel ‚Äî —Å–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø')
}
</script>
</body
