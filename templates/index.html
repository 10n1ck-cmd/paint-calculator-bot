<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport"
 content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–æ—Ä–æ—à–∫–æ–≤–æ–π –∫—Ä–∞—Å–∫–∏</title>

<style>
body { font-family: system-ui; background:#f8fafc; margin:0; }
.container { max-width:600px; margin:auto; padding:16px; }
h2,h3 { margin-top:24px; }
input,select,button {
  width:100%; padding:10px; margin-top:8px; font-size:16px;
}
button { background:#2563eb; color:#fff; border:none; border-radius:6px; }
.result { margin-top:16px; background:#e5e7eb; padding:12px; border-radius:6px; }
.banner {
  margin-top:24px; padding:12px; background:#f1f5f9; text-align:center;
  font-size:14px;
}
</style>
</head>

<body>
<div class="container">

<h2>üéì –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç</h2>

<label>–ü–ª–æ—â–∞–¥—å, –º¬≤</label>
<input id="area" type="number" step="0.001">

<label>–ü–ª–æ—Ç–Ω–æ—Å—Ç—å, –≥/—Å–º¬≥</label>
<input id="density" type="number" step="0.001">

<label>–¢–æ–ª—â–∏–Ω–∞ —Å–ª–æ—è, –º–∫–º</label>
<input id="thickness" type="number" step="1">

<label>–ü–æ—Ç–µ—Ä–∏, %</label>
<input id="loss" type="number" step="1" value="15">

<h3>–ö—Ä–∞—Å–∫–∞ 1 ‚Äî —Ü–µ–Ω–∞ ‚ÇΩ/–∫–≥</h3>
<input id="price1" type="number" step="0.01">

<h3>–ö—Ä–∞—Å–∫–∞ 2 ‚Äî —Ü–µ–Ω–∞ ‚ÇΩ/–∫–≥</h3>
<input id="price2" type="number" step="0.01">

<button onclick="calculate()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>

<div id="output" class="result"></div>

<h2>üõí –ü–æ–ª—É—á–∏—Ç—å –≤—ã–≥–æ–¥–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</h2>

<label>–¢–∏–ø –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏</label>
<select id="surface">
  <option>–ú–∞—Ç–æ–≤–∞—è</option>
  <option>–ì–ª—è–Ω—Ü–µ–≤–∞—è</option>
  <option>–ú—É–∞—Ä</option>
  <option>–®–∞–≥—Ä–µ–Ω—å</option>
  <option>–ê–Ω—Ç–∏–∫</option>
</select>

<label>–¶–≤–µ—Ç (RAL / –Ω–∞–∑–≤–∞–Ω–∏–µ)</label>
<input id="color">

<label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ, –∫–≥</label>
<input id="quantity" type="number" step="0.1">

<button onclick="sendOrder()">–ü–æ–ª—É—á–∏—Ç—å –≤—ã–≥–æ–¥–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</button>

<div class="banner">
–¢—É—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–∞—à–∞ —Ä–µ–∫–ª–∞–º–∞<br>
–û–±—Ä–∞—â–∞–π—Ç–µ—Å—å: <b>@A_n1ck</b>
</div>

</div>

<script>
const tg = window.Telegram.WebApp;
let lastCalc = null;

function calculate() {
  const S = parseFloat(area.value);
  const rho = parseFloat(density.value);
  const h = parseFloat(thickness.value);
  const loss = parseFloat(loss.value) / 100;
  const p1 = parseFloat(price1.value);
  const p2 = parseFloat(price2.value);

  if ([S,rho,h,p1,p2].some(isNaN)) {
    alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è");
    return;
  }

  // q = œÅ * h / 1000
  const q = (rho * h) / 1000;

  // Q = q * S * (1 + loss)
  const Q = q * S * (1 + loss);

  const C1 = Q * p1;
  const C2 = Q * p2;

  const cheaper = C1 < C2 ? "–ö—Ä–∞—Å–∫–∞ 1" : "–ö—Ä–∞—Å–∫–∞ 2";
  const diff = Math.abs(C1 - C2);
  const percent = (diff / Math.max(C1, C2) * 100).toFixed(1);

  lastCalc = {
    area: S,
    density: rho,
    thickness: h,
    loss: loss*100,
    consumption: Q.toFixed(3),
    cost1: C1.toFixed(2),
    cost2: C2.toFixed(2),
    cheaper,
    percent
  };

  output.innerHTML = `
<b>–†–∞—Å—Ö–æ–¥:</b> ${Q.toFixed(3)} –∫–≥<br>
<b>–°—Ç–æ–∏–º–æ—Å—Ç—å –∫—Ä–∞—Å–∫–∏ 1:</b> ${C1.toFixed(2)} ‚ÇΩ<br>
<b>–°—Ç–æ–∏–º–æ—Å—Ç—å –∫—Ä–∞—Å–∫–∏ 2:</b> ${C2.toFixed(2)} ‚ÇΩ<br>
<b>–í—ã–≥–æ–¥–Ω–µ–µ:</b> ${cheaper}<br>
<b>–≠–∫–æ–Ω–æ–º–∏—è:</b> ${percent} %
`;
}

function sendOrder() {
  if (!lastCalc) {
    alert("–°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Ä–∞—Å—á—ë—Ç");
    return;
  }

  fetch("/api/order", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({
      telegram: tg.initDataUnsafe.user,
      calculation: lastCalc,
      order: {
        surface: surface.value,
        color: color.value,
        quantity: quantity.value
      }
    })
  }).then(()=>alert("–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –∞–¥–º–∏–Ω—É"));
}
</script>

</body>
</html>
