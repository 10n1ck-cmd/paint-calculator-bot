<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∫—Ä–∞—Å–∫–∏</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; }
.tab { display: none; }
.tab.active { display: block; }
button { padding: 10px 15px; margin: 5px; }
input { margin: 5px 0; padding: 5px; width: 100%; }
.banner { background: #eee; padding: 10px; margin-top: 20px; text-align:center; font-size:0.9em;}
.result { background: #f9f9f9; padding: 10px; margin-top: 10px; border: 1px solid #ccc; }
</style>
</head>
<body>

<h2>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–æ—Ä–æ—à–∫–æ–≤—ã—Ö –∫—Ä–∞—Å–æ–∫</h2>

<div>
    <button onclick="showTab('theory')">–¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç</button>
    <button onclick="showTab('practice')">–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç</button>
</div>

<!-- –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–π -->
<div id="theory" class="tab">
    <h3>–¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç</h3>
    <input id="area_theory" type="number" step="0.001" placeholder="–ü–ª–æ—â–∞–¥—å (–º¬≤)">
    <input id="density1" type="number" step="0.001" placeholder="–ü–ª–æ—Ç–Ω–æ—Å—Ç—å –∫—Ä–∞—Å–∫–∏ 1 (–≥/—Å–º¬≥)">
    <input id="thickness1" type="number" step="0.1" placeholder="–¢–æ–ª—â–∏–Ω–∞ –∫—Ä–∞—Å–∫–∏ 1 (–º–∫–º)">
    <input id="price1" type="number" step="0.01" placeholder="–¶–µ–Ω–∞ –∫—Ä–∞—Å–∫–∏ 1 (‚ÇΩ)">
    <input id="density2" type="number" step="0.001" placeholder="–ü–ª–æ—Ç–Ω–æ—Å—Ç—å –∫—Ä–∞—Å–∫–∏ 2 (–≥/—Å–º¬≥)">
    <input id="thickness2" type="number" step="0.1" placeholder="–¢–æ–ª—â–∏–Ω–∞ –∫—Ä–∞—Å–∫–∏ 2 (–º–∫–º)">
    <input id="price2" type="number" step="0.01" placeholder="–¶–µ–Ω–∞ –∫—Ä–∞—Å–∫–∏ 2 (‚ÇΩ)">
    <button onclick="calculate('theory')">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
</div>

<!-- –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π -->
<div id="practice" class="tab">
    <h3>–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç</h3>
    <input id="area_practice" type="number" step="0.001" placeholder="–ü–ª–æ—â–∞–¥—å (–º¬≤)">
    <input id="cons1" type="number" step="0.001" placeholder="–†–∞—Å—Ö–æ–¥ –∫—Ä–∞—Å–∫–∏ 1 (–∫–≥)">
    <input id="pricep1" type="number" step="0.01" placeholder="–¶–µ–Ω–∞ –∫—Ä–∞—Å–∫–∏ 1 (‚ÇΩ)">
    <input id="cons2" type="number" step="0.001" placeholder="–†–∞—Å—Ö–æ–¥ –∫—Ä–∞—Å–∫–∏ 2 (–∫–≥)">
    <input id="pricep2" type="number" step="0.01" placeholder="–¶–µ–Ω–∞ –∫—Ä–∞—Å–∫–∏ 2 (‚ÇΩ)">
    <button onclick="calculate('practice')">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
</div>

<div class="result" id="result"></div>

<div class="banner">
    üîî –¢—É—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–∞—à–∞ —Ä–µ–∫–ª–∞–º–∞. –û–±—Ä–∞—â–∞–π—Ç–µ—Å—å: <a href="https://t.me/A_n1ck" target="_blank">@A_n1ck</a>
</div>

<script>
function showTab(id){
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    document.getElementById('result').innerHTML = '';
}

function calculate(mode){
    let calc = {};
    if(mode=='theory'){
        const area = parseFloat(document.getElementById('area_theory').value);
        const d1 = parseFloat(document.getElementById('density1').value);
        const t1 = parseFloat(document.getElementById('thickness1').value);
        const p1 = parseFloat(document.getElementById('price1').value);
        const d2 = parseFloat(document.getElementById('density2').value);
        const t2 = parseFloat(document.getElementById('thickness2').value);
        const p2 = parseFloat(document.getElementById('price2').value);

        const coverage1 = 1000/(d1*t1);
        const coverage2 = 1000/(d2*t2);
        const kgm1 = area/coverage1*1.15; // 15% –ø–æ—Ç–µ—Ä–∏
        const kgm2 = area/coverage2*1.15;
        const r1 = kgm1*p1;
        const r2 = kgm2*p2;
        const cheaper = r1<r2?'–ö—Ä–∞—Å–∫–∞ 1':'–ö—Ä–∞—Å–∫–∞ 2';
        const economyRub = Math.abs(r1-r2)/area;
        const economyPct = Math.round(Math.abs(r1-r2)/Math.min(r1,r2)*100);

        calc = {mode, kgm1, kgm2, r1, r2, cheaper, economyRub, economyPct};
    } else {
        const area = parseFloat(document.getElementById('area_practice').value);
        const c1 = parseFloat(document.getElementById('cons1').value);
        const c2 = parseFloat(document.getElementById('cons2').value);
        const p1 = parseFloat(document.getElementById('pricep1').value);
        const p2 = parseFloat(document.getElementById('pricep2').value);

        const kgm1 = c1/area;
        const kgm2 = c2/area;
        const r1 = c1*p1/area;
        const r2 = c2*p2/area;
        const cheaper = r1<r2?'–ö—Ä–∞—Å–∫–∞ 1':'–ö—Ä–∞—Å–∫–∞ 2';
        const economyRub = Math.abs(r1-r2);
        const economyPct = Math.round(Math.abs(r1-r2)/Math.min(r1,r2)*100);

        calc = {mode, kgm1, kgm2, r1, r2, cheaper, economyRub, economyPct};
    }

    document.getElementById('result').innerHTML = `
        <b>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:</b><br>
        –ö—Ä–∞—Å–∫–∞ 1: ${calc.kgm1.toFixed(3)} –∫–≥/–º¬≤, ${calc.r1.toFixed(2)} ‚ÇΩ/–º¬≤<br>
        –ö—Ä–∞—Å–∫–∞ 2: ${calc.kgm2.toFixed(3)} –∫–≥/–º¬≤, ${calc.r2.toFixed(2)} ‚ÇΩ/–º¬≤<br>
        –í—ã–≥–æ–¥–Ω–µ–µ: ${calc.cheaper}<br>
        –≠–∫–æ–Ω–æ–º–∏—è: ${calc.economyRub.toFixed(2)} ‚ÇΩ/–º¬≤ (${calc.economyPct}%)<br>
        <button onclick="sendOrder()">–ü–æ–ª—É—á–∏—Ç—å –≤—ã–≥–æ–¥–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ + PDF</button>
    `;

    window.calcData = calc;
}

function sendOrder(){
    const user = {id: Math.floor(Math.random()*1000000)};
    fetch('/api/order',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({calc: window.calcData, user})
    }).then(r=>r.blob()).then(blob=>{
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'calc.pdf';
        document.body.appendChild(a);
        a.click();
        a.remove();
    }).catch(e=>alert('–û—à–∏–±–∫–∞: '+e));
}

showTab('theory'); // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
</script>

</body>
</html>
